# Brainstorming Skill 流程规范改造设计

## 1. 背景与目标

当前项目在 Telegram 交互链路上已经可用且定义清晰；本次改造只针对 `brainstorming` 的流程规范，解决“该问什么、何时收敛、何时可结束”不够明确的问题。

目标：
- 保留现有 Telegram 交互能力，不改二进制与安装链路。
- 将 brainstorming 从“泛问答”改为“分析驱动的收敛流程”。
- 让每轮提问都可解释、可回写、可推动决策。

非目标：
- 不修改 `telegram-brainstorming` 运行时逻辑。
- 不引入新技能依赖或新命令行工具。

## 2. 现状分析（六维底稿）

- 目标：通过对话把模糊想法收敛到用户确认的最优方案。
- 现状：现有 `brainstorming` 已有流程框架，但缺少问题设计约束与收敛判定标准。
- 约束：保持原有 skill 定位与现有 Telegram 使用方式不变。
- 风险：如果规则过松，容易出现重复提问、过早实现讨论、无法收敛。
- 成功标准：可在有限轮次中形成稳定推荐，并有明确“完成”判据。
- 未知项：不同任务复杂度下的轮次上限是否需要固定阈值（先不硬编码）。

## 3. 方案比较与推荐

### 方案 A：分析驱动漏斗（推荐）
- 核心：先建立结构化分析，再用“一次一问”持续缩小方案空间。
- 优势：最贴合“基于现状与需求、结合专家经验逐步收敛”的目标。
- 代价：流程约束更强，文案更长。

### 方案 B：假设验证驱动
- 核心：先列关键假设，再逐题验证/证伪。
- 优势：问题质量高、目标明确。
- 代价：对执行者抽象能力要求更高。

### 方案 C：决策矩阵驱动
- 核心：持续给候选方案打分并排序。
- 优势：可解释性强。
- 代价：轻量场景偏重。

推荐结论：采用方案 A 作为主流程，保留方案比较能力但不过度矩阵化。

## 4. 新流程设计（状态机）

将 `brainstorming` 重构为 6 个状态：

1. `Context Scan`
- Entry：接到创意/改造类请求。
- Action：读取项目现状、文档、近期变更。
- Exit：形成可引用的上下文摘要。

2. `Analysis Init`
- Entry：上下文摘要可用。
- Action：初始化六维底稿（目标/现状/约束/风险/成功标准/未知项）。
- Exit：至少有一版可继续迭代的底稿。

3. `Options Init`
- Entry：六维底稿初版存在。
- Action：基于专家经验提出 2-3 个候选方向并说明权衡。
- Exit：用户确认要沿哪条方向收敛。

4. `Single-Question Loop`
- Entry：有候选方向且仍存在关键未知项。
- Action：一次只问一个高价值问题，回答后强制回写底稿与方案状态。
- Exit：达到收敛判定或触发异常分支。

5. `Convergence Check`
- Entry：完成若干轮单问题收敛。
- Action：检查是否满足完成阈值。
- Exit：满足则进入设计定稿，不满足则回到单问题循环。

6. `Design Finalization`
- Entry：通过收敛判定。
- Action：分段展示设计并逐段确认。
- Exit：用户确认设计可进入文档化与后续 planning。

## 5. 问题设计协议（重点改造）

每轮提问前必须完成：
1. 缺口定位：识别当前最阻碍决策的未知项。
2. 类型选择：仅允许 `澄清事实`、`比较偏好`、`约束确认`。
3. 收敛收益检查：回答后必须能删除未知项或淘汰候选方案。

提问格式：
- 一次一问。
- 多选优先（2-4 个选项，附简短影响说明）。
- 问题必须可映射到决策变化，禁止无收敛价值问题。

回答后强制回写：
- 更新六维底稿（无变化需说明原因）。
- 更新候选方案状态（保留/降级/淘汰）。
- 更新当前推荐与理由。

## 6. 软拦截与异常分支

采用软拦截策略：
- 若偏离流程（如提前进入实现讨论），明确提示“当前仍在设计阶段”，并将话题拉回当前状态。
- 若信息冲突，先标记冲突，再用一个澄清问题解决。
- 若连续 3 轮不淘汰方案，强制改为对比型问题以压缩方案空间。
- 若目标漂移，重置目标与成功标准并继续收敛。

## 7. 收敛判定与完成标准

进入设计定稿前需同时满足：
- 高影响未知项降到 0-1 个。
- 推荐方案连续两轮保持稳定且理由增强。
- 成功标准可验证（可检查结果而非抽象描述）。
- 用户明确认可当前方向。

## 8. `SKILL.md` 重构建议目录

1. Overview  
2. State Machine  
3. Six-Dimension Analysis Ledger  
4. Question Protocol  
5. Option Management  
6. Soft-Gate Recovery  
7. Completion Contract  
8. After Design（仅衔接 `writing-plans`）

## 9. 验收方式（文案级）

用 3 类场景走查：
- 简单需求：是否仍执行完整流程但保持简洁。
- 约束冲突：是否能通过澄清题处理冲突。
- 偏好变化：是否能更新推荐并解释变化原因。

验收要点：
- 始终一次一问。
- 每轮都有回写动作。
- 能在有限轮次形成稳定推荐并给出完成判定。

## 10. 下一步

本设计文档已确定方向，后续仅进入 `writing-plans` 生成实施计划，不直接进入实现。

## 11. 兼容性验证记录

- 验证时间：2026-02-19T15:04:06+08:00
- 验证命令：`scripts/run_telegram_brainstorming.sh --prompt "A/B/C test"`
- 结果摘要：程序成功发送提问并收到 Telegram 回复 `B`，会话正常结束。
- 兼容性结论：本次改造仅涉及 `brainstorming` skill 文案规范，不影响既有 Telegram 运行链路与交互通道约束。
